To do:
*********************************
** Curent Functions small updates 
In generateEggChamberSummaryTable
 -Generate summary statistics per condition, and save as text file.
 -Include table and summary stats for egg chambers of desired stages. Also include clusters if the Data is there.

- in scatterPlotMetricBySample: Exclude egg chamber stages but plot by sample?

- in scatterPlotMetricBySample and scatterPlotMetricByEggChamber
  -overlay egg chamber mean over scatter plot.
  -Color code egg chamber by stage? By condition? color symbols, add alpha

- add function to save plot, maybe along w some metadata.

- Fiji: add log file with time stamps and list of parameters used for each of the macros. 

X From Feiyue: A few minor notes: 1. would be great if you can make it workable with .nd2 but may not be necessary since I would need to run the batch.detrended script first any way, I believe the output of that is .tif? so if the script is a step 2, it may be fine as it is; 2. Gotta make sure that the egg chambers are absolutely not on top of each other (which is true to most images but there could be exceptions); 3. I wonder if there's a way to prevent the script from proceeding when no ROI is added - in the majority of cases, I will likely only select one egg chamber per image. If I somehow forgot to hit "CMD+t" for one image in the middle of the selection, I might need to start all over?

*********************************
** Architecture questions

x nucleolus segmentation and background. What is the current status? Check how to integrate that with the nuclei table.

- how to save analyses w different parameters w/o overwriting?

x Cluster metrics: Figure out when adding clusters whether we want a second table for the cluster stats and then integrate mean cluster stats to the nuclei table.
This will be needed if we want background correction for the clusters.

x Same for plotting - should we make function by nucleus or by cluster. 

*********************************
** robustness
X rename existing methods so it's unambiguous they apply to nuclei metrics.
X Make sure all operations are performed on both t and fullT to maintain consistency.
X Make sure that methods to subtract background etc check for pre-exisitng runs (do not subtract twice). Also that they can be run at any point, e.g. before or after the plasmInt and the nucleoliInt have been added.
X make table construction and methods modular whether or not one wants to quantify clusters.
X what if nuclei #s don't match between nucleus analysis and cluster analysis? [just loading data from nuclei that are in the table already]
- check manually that nuclei/cluster IDs match up
- some nuclei ordering seems alphabetical. Check it is kosher/ Re-order?
- QC on nuclei based on geometry/sphericity/deviation from the mean volume to weed out poorly segmented ones?
- Fiji: erase previous nuclei masks when performing a new cluster detection run. Or save folder under different name.

*********************************
** Documentation:
- data org: add screen cap.
- nuclei segmentation walk through.
- cluster detection walk through.

*********************************
** New functions:
- Histogram plot for nuclei metrics by egg chamber, by sample.
- plot metric a vs metric b. Use for z, egg chamber stage, sample.
- normalize metrics by z? By DAPI signal?
- add a checksum kind of function? E.g. plasmCorr vs subtraction of the plasm Int. (Are they supposed to be equal? Or is plasmCorr computed plane by plane?)
X loadNucleoliInt. Collect data from all files and append columns to t and fullT. Ignore neighbors, NumberOfVoxels, maybe Volume as well, load from the geometry file instead.
X LoadPlasmInt. Collect all files and move to t and fullT. Ignore neighbors, NumberOfVoxels, maybe Volume as well, load from the geometry file instead. 
- Method to correct nucleoli and plasmInt for wholeImgInt? Maybe include that in existing function.
X loadCluster. Generate new table. Generate a method to easily replicate nucleus metric to the format of the cluster table (i.e. replicate each nucleus metric as many times as there are clusters in the nucleus, for dimensions to match).
X load cluster geometry (sort of, just volume)
X streamline cluster table
X generate summary stats of clusters and add to nuclei table
- update the background correction method to apply to everything.

*********************************
** notes on analysis
- Judging by DAPI, median/wholeImgCorr seems the metric that gives the least CV. Not by a ton vs mean. The omg correction definitely helps though.
- unclear how EC stage, z impact metrics, need function to plot a vs b to figure that out.
- also maybe have a volume cutoff and/or DAPI std to be able to exclude poorly segmented nuclei if we think they will be an issue.
- prepare simple scripts for nucleus only analysis, cluster analysis, +/- egg chamber staging.
- why is the volume of plasm + nucleoli not equal to nucVolume? The delta is small (~1% of nuclei volume) but non zero. -> reduced the delta to < 1e-4 of the total volume by facing the morphology closing operation in Fiji. I'm guessing the closing can make the nucleoplasm slightly larger than the nucleus? Maybe need to be remarked at the end.

- build list of nuclei that are problematic

*********************************
** Fiji bugs
x nucleoliInt seems empty
X clusters quant only saved for nuc1???

*********************************
For the scatter by eggChamber function:
- use https://www.mathworks.com/help/matlab/ref/inputparser.html to parse input.
Parameters: 
eggChamberStagesToInclude, 
samplesToInclude, 
colorCode (sample; eggChamber; condition; eggChamberStage; any variable really - check how to build the name intuitively. Maybe some keywords or full variable name), 
colorMap (include cBrewer options), 
alpha, 
addMeanAndErrorBar
Different grouping spacing modes?
Should I trim the data table as an easier way to process the data plotting?












